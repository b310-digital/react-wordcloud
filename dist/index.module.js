import t from"lodash.debounce";import n,{useRef as r,useState as e,useEffect as o}from"react";import{select as i}from"d3-selection";import a from"resize-observer-polyfill";import"d3-transition";import{range as s,min as u,max as l,descending as f}from"d3-array";import c from"d3-cloud";import d from"lodash.clonedeep";import h from"seedrandom";import m from"tippy.js";import{dispatch as y}from"d3-dispatch";import{scaleOrdinal as p,scaleLinear as x,scaleSqrt as v,scaleLog as g}from"d3-scale";import{schemeCategory10 as b}from"d3-scale-chromatic";function w(){return w=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])}return t},w.apply(this,arguments)}var M=Math.PI/180,z=64,k=2048;function W(){var t=[256,256],n=S,r=O,e=j,o=T,i=T,a=A,s=q,u=D,l=[],f=Infinity,c=y("word","end"),d=Math.random,h={},m=F,p=!1;function x(n,r,e){for(var o,i,a,s,l,f=r.x,c=r.y,h=Math.sqrt(t[0]*t[0]+t[1]*t[1]),m=u(t),y=d()<.5?1:-1,p=-y;(o=m(p+=y))&&(i=~~o[0],a=~~o[1],!(Math.min(Math.abs(i),Math.abs(a))>=h));)if(r.x=f+i,r.y=c+a,!(r.x+r.x0<0||r.y+r.y0<0||r.x+r.x1>t[0]||r.y+r.y1>t[1]||e&&E(r,n,t[0])||e&&!((s=r).x+s.x1>(l=e)[0].x&&s.x+s.x0<l[1].x&&s.y+s.y1>l[0].y&&s.y+s.y0<l[1].y))){for(var x,v=r.sprite,g=r.width>>5,b=t[0]>>5,w=r.x-(g<<4),M=127&w,z=32-M,k=r.y1-r.y0,W=(r.y+r.y0)*b+(w>>5),S=0;S<k;S++){x=0;for(var O=0;O<=g;O++)n[W+O]|=x<<z|(O<g?(x=v[S*g+O])>>>M:0);W+=b}return delete r.sprite,!0}return!1}return h.canvas=function(t){return arguments.length?(m=P(t),h):m},h.start=function(){var u=function(t){t.width=t.height=1;var n=Math.sqrt(t.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,1,1).data.length>>2);t.width=(z<<5)/n,t.height=k/n;var r=t.getContext("2d");return r.fillStyle=r.strokeStyle="red",r.textAlign="center",{context:r,ratio:n}}(m()),f=new Uint32Array((t[0]>>5)*t[1]),y=null,v=[],g=l.map(function(t,u){return t.text=n.call(this,t,u),t.font=r.call(this,t,u),t.style=o.call(this,t,u),t.weight=i.call(this,t,u),t.rotate=a.call(this,t,u),t.size=~~e.call(this,t,u),t.padding=s.call(this,t,u),t}).sort(function(t,n){return n.size-t.size});function b(n){var r=50*n,e=Math.min(50*(n+1),l.length);!function(n,r){for(var e=n;e<r;e+=1){var o=g[e];o.x=t[0]*(d()+.5)>>1,o.y=t[1]*(d()+.5)>>1,I(u,o,g,e),o.hasText&&x(f,o,y)&&(v.push(o),c.call("word",h,o),y?C(y,o):y=[{x:o.x+o.x0,y:o.y+o.y0},{x:o.x+o.x1,y:o.y+o.y1}],o.x-=t[0]>>1,o.y-=t[1]>>1)}}(r,e),p||(e<l.length?setTimeout(function(){return b(n+1)},0):(h.stop(),c.call("end",h,v,y)))}return setTimeout(function(){return b(0)},0),h},h.revive=function(){return p=!1,h},h.stop=function(){return p=!0,h},h.timeInterval=function(t){return arguments.length?(f=null==t?Infinity:t,h):f},h.words=function(t){return arguments.length?(l=t,h):l},h.size=function(n){return arguments.length?(t=[+n[0],+n[1]],h):t},h.font=function(t){return arguments.length?(r=P(t),h):r},h.fontStyle=function(t){return arguments.length?(o=P(t),h):o},h.fontWeight=function(t){return arguments.length?(i=P(t),h):i},h.rotate=function(t){return arguments.length?(a=P(t),h):a},h.text=function(t){return arguments.length?(n=P(t),h):n},h.spiral=function(t){return arguments.length?(u=R[t]||t,h):u},h.fontSize=function(t){return arguments.length?(e=P(t),h):e},h.padding=function(t){return arguments.length?(s=P(t),h):s},h.random=function(t){return arguments.length?(d=t,h):d},h.on=function(){var t=c.on.apply(c,arguments);return t===c?h:t},h}function S(t){return t.text}function O(){return"serif"}function T(){return"normal"}function j(t){return Math.sqrt(t.value)}function A(){return 30*(~~(6*Math.random())-3)}function q(){return 1}function I(t,n,r,e){if(!n.sprite){var o=t.context,i=t.ratio;o.clearRect(0,0,(z<<5)/i,k/i);var a=0,s=0,u=0,l=r.length;for(--e;++e<l;){n=r[e],o.save(),o.font=n.style+" "+n.weight+" "+~~((n.size+1)/i)+"px "+n.font;var f=o.measureText(n.text+"m").width*i,c=n.size<<1;if(n.rotate){var d=Math.sin(n.rotate*M),h=Math.cos(n.rotate*M),m=f*h,y=f*d,p=c*h,x=c*d;f=Math.max(Math.abs(m+x),Math.abs(m-x))+31>>5<<5,c=~~Math.max(Math.abs(y+p),Math.abs(y-p))}else f=f+31>>5<<5;if(c>u&&(u=c),a+f>=z<<5&&(a=0,s+=u,u=0),s+c>=k)break;o.translate((a+(f>>1))/i,(s+(c>>1))/i),n.rotate&&o.rotate(n.rotate*M),o.fillText(n.text,0,0),n.padding&&(o.lineWidth=2*n.padding,o.strokeText(n.text,0,0)),o.restore(),n.width=f,n.height=c,n.xoff=a,n.yoff=s,n.x1=f>>1,n.y1=c>>1,n.x0=-n.x1,n.y0=-n.y1,n.hasText=!0,a+=f}for(var v=o.getImageData(0,0,(z<<5)/i,k/i).data,g=[];--e>=0;)if((n=r[e]).hasText){for(var b=(f=n.width)>>5,w=(c=n.y1-n.y0,0);w<c*b;w++)g[w]=0;if(null==(a=n.xoff))return;s=n.yoff;for(var W=0,S=-1,O=0;O<c;O++){for(w=0;w<f;w++){var T=v[(s+O)*(z<<5)+(a+w)<<2]?1<<31-w%32:0;g[b*O+(w>>5)]|=T,W|=T}W?S=O:(n.y0++,c--,O--,s++)}n.y1=n.y0+S,n.sprite=g.slice(0,(n.y1-n.y0)*b)}}}function E(t,n,r){for(var e,o=t.sprite,i=t.width>>5,a=t.x-(i<<4),s=127&a,u=32-s,l=t.y1-t.y0,f=(t.y+t.y0)*(r>>=5)+(a>>5),c=0;c<l;c++){e=0;for(var d=0;d<=i;d++)if((e<<u|(d<i?(e=o[c*i+d])>>>s:0))&n[f+d])return!0;f+=r}return!1}function C(t,n){var r=t[0],e=t[1];n.x+n.x0<r.x&&(r.x=n.x+n.x0),n.y+n.y0<r.y&&(r.y=n.y+n.y0),n.x+n.x1>e.x&&(e.x=n.x+n.x1),n.y+n.y1>e.y&&(e.y=n.y+n.y1)}function D(t){var n=t[0]/t[1];return function(t){return[n*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function F(){return document.createElement("canvas")}function P(t){return"function"==typeof t?t:function(){return t}}var R={archimedean:D,rectangular:function(t){var n=4*t[0]/t[1],r=0,e=0;return function(t){var o=t<0?-1:1;switch(Math.sqrt(1+4*o*t)-o&3){case 0:r+=n;break;case 1:e+=4;break;case 2:r-=n;break;default:e-=4}return[r,e]}}};function H(t,n){return t[Math.floor(n()*t.length)]}function L(t){return t.size+"px"}function N(t){return t.text}function U(t){return"translate("+t.x+", "+t.y+")"+("number"==typeof t.rotate?"rotate("+t.rotate+")":"")}function V(t){var n,r=t.callbacks,e=t.maxWords,o=t.options,i=t.selection,a=t.size,s=o.deterministic,y=o.enableOptimizations,p=o.fontFamily,b=o.fontStyle,M=o.fontSizes,z=o.fontWeight,k=o.padding,S=o.randomSeed,O=o.rotations,T=o.rotationAngles,j=o.spiral,A=o.scale,q=t.words.concat().sort(function(t,n){return f(t.value,n.value)}).slice(0,e),I=h(s?S||"deterministic":null);(n=y?W():c()).size(a).padding(k).words(d(q)).rotate(function(){return void 0===O?30*(~~(6*I())-3):function(t,n,r){if(t<1)return 0;var e=[];if(1===t)e=[n[0]];else{e=[].concat(n);for(var o=(n[1]-n[0])/(t-1),i=n[0]+o;i<n[1];)e.push(i),i+=o}return H(e,r)}(O,T,I)}).spiral(j).random(I).text(N).font(p).fontStyle(b).fontWeight(z),function t(e,a){void 0===a&&(a=1),y&&n.revive(),n.fontSize(function(t){var n=function(t,n,r){var e,o=u(t,function(t){return Number(t.value)}),i=l(t,function(t){return Number(t.value)});switch(r){case"log":e=g;break;case"sqrt":e=v;break;default:e=x}return e().domain([o,i]).range(n)}(q,e,A);return n(t.value)}).on("end",function(n){if(q.length!==n.length&&a<=10){10===a&&console.warn("Unable to layout "+(q.length-n.length)+" word(s) after "+a+" attempts.  Consider: (1) Increasing the container/component size. (2) Lowering the max font size. (3) Limiting the rotation angles.");var s=Math.max(.95*e[0],1);t([s,Math.max(.95*e[1],s)],a+1)}else!function(t){var n,r=t.callbacks,e=t.options,o=t.random,i=t.words,a=r.getWordColor,s=r.getWordTooltip,u=r.onWordClick,l=r.onWordMouseOver,f=r.onWordMouseOut,c=e.colors,d=e.enableTooltip,h=e.fontStyle,y=e.fontWeight,p=e.textAttributes,x=e.tooltipOptions,v=e.fontFamily,g=e.transitionDuration;function b(t){return a?a(t):H(c,o)}t.selection.selectAll("text").data(i).join(function(t){var r=t.append("text").on("click",function(t,n){u&&u(n,t)}).on("mouseover",function(t,r){!d||n&&!n.isDestroyed||(n=m(t.target,w({animation:"scale",arrow:!0,content:function(){return s(r)},onHidden:function(t){t.destroy(),n=null}},x))),l&&l(r,t)}).on("mouseout",function(t,r){n&&!n.state.isVisible&&n.destroy(),f&&f(r,t)}).attr("cursor",u?"pointer":"default").attr("fill",b).attr("font-family",v).attr("font-style",h).attr("font-weight",y).attr("text-anchor","middle").attr("transform","translate(0, 0) rotate(0)");"object"==typeof p&&Object.keys(p).forEach(function(t){r=r.attr(t,p[t])}),r=r.call(function(t){return t.transition().duration(g).attr("font-size",L).attr("transform",U).text(N)})},function(t){t.transition().duration(g).attr("fill",b).attr("font-family",v).attr("font-size",L).attr("transform",U).text(N)},function(t){t.transition().duration(g).attr("fill-opacity",0).remove()})}({callbacks:r,options:o,random:I,selection:i,words:n})}).start()}(M)}var B=["callbacks","maxWords","minSize","options","size","words"],G={getWordTooltip:function(t){return t.text+" ("+t.value+")"}},J={colors:s(20).map(function(t){return t.toString()}).map(p(b)),deterministic:!1,enableOptimizations:!1,enableTooltip:!0,fontFamily:"times new roman",fontSizes:[4,32],fontStyle:"normal",fontWeight:"normal",padding:1,rotationAngles:[-90,90],scale:"sqrt",spiral:"rectangular",tooltipOptions:{},transitionDuration:600};function K(s){var u=s.callbacks,l=s.maxWords,f=void 0===l?100:l,c=s.minSize,d=s.options,h=s.size,m=s.words,y=function(t,n){if(null==t)return{};var r,e,o={},i=Object.keys(t);for(e=0;e<i.length;e++)n.indexOf(r=i[e])>=0||(o[r]=t[r]);return o}(s,B),p=function(t,n,s){var u=r(),l=e(n),f=l[0],c=l[1],d=e(null),h=d[0],m=d[1];return o(function(){var r=u.current,e=i(r).append("svg").style("display","block");"object"==typeof s&&Object.keys(s).forEach(function(t){e=e.attr(t,s[t])});var o=e.append("g");function l(t,n){e.attr("height",n).attr("width",t),o.attr("transform","translate("+t/2+", "+n/2+")"),c([t,n])}m(o);var f=0,d=0;void 0===n?(f=r.parentElement.offsetWidth,d=r.parentElement.offsetHeight):(f=n[0],d=n[1]),l(f=Math.max(f,t[0]),d=Math.max(d,t[1]));var h=new a(function(t){if(t&&0!==t.length&&void 0===n){var r=t[0].contentRect;l(r.width,r.height)}});return h.observe(r),function(){h.unobserve(r),i(r).selectAll("*").remove()}},[n,t,s]),[u,h,f]}(c,h,d.svgAttributes),x=p[0],v=p[1],g=p[2],b=r(t(V,100));return o(function(){if(v){var t=w({},G,u),n=w({},J,d);b.current({callbacks:t,maxWords:f,options:n,selection:v,size:g,words:m})}},[f,u,d,v,g,m]),/*#__PURE__*/n.createElement("div",w({ref:x,style:{height:"100%",width:"100%"}},y))}K.defaultProps={callbacks:G,maxWords:100,minSize:[300,300],options:J};export{K as ReactWordCloud,G as defaultCallbacks,J as defaultOptions};
//# sourceMappingURL=index.module.js.map
